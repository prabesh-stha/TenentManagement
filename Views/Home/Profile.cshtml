@model TenentManagement.Models.User.UserModel
@using TenentManagement.Services.Utilities

@{
    ViewData["Title"] = "User Profile";
}

<style>
    .profile-container {
        background-color: #fff;
        border-radius: 15px;
        box-shadow: 0 0 20px rgba(0,0,0,0.08);
        padding: 30px;
    }

    .profile-img-wrapper {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        border: 4px solid #dee2e6;
        background-color: #f0f0f0;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .profile-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
        background-color: #f0f0f0;
        display: block;
    }

    .profile-label {
        font-weight: 600;
        color: #6c757d;
    }

    .profile-value {
        font-size: 1.1rem;
    }

    .profile-section {
        margin-bottom: 20px;
    }

    .section-title {
        font-weight: 600;
        font-size: 1.25rem;
        border-bottom: 2px solid #dee2e6;
        padding-bottom: 5px;
        margin-bottom: 20px;
    }

    .img-upload-input {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 200px;
        height: 200px;
        opacity: 0;
        cursor: pointer;
        z-index: 2;
    }

    .payment-actions {
        margin-top: 30px;
    }
</style>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="profile-container row">

                <!-- Profile Image and Basic Info -->
                <div class="col-md-4 d-flex flex-column align-items-center mb-4 mb-md-0 position-relative">
                    <div class="profile-img-wrapper">
                        <img id="profileImage" src="https://picsum.photos/200/" class="profile-img" alt="Profile Picture" />
                        <input type="file" id="imgUpload" accept="image/*" class="img-upload-input" />
                    </div>

                    <div class="mt-3 text-center">
                        <h4>@Model.FirstName.ToTitleCase() @Model.LastName.ToTitleCase()</h4>
                        <p class="text-muted">@Model.Email</p>

                        <div class="d-flex justify-content-center gap-2 mt-2">
                            <a asp-action="ChangeEmail" asp-controller="Authentication" asp-route-id="@Model.Id" class="btn btn-sm btn-primary">
                                Change Email
                            </a>
                            <a asp-action="ChangePassword" asp-controller="Authentication" asp-route-id="@Model.Id" class="btn btn-sm btn-primary">
                                Change Password
                            </a>
                        </div>
                    </div>
                </div>

                <!-- User Information -->
                <div class="col-md-8">
                    <div class="section-title d-flex align-items-center">
                        <h1 class="m-0">User Information</h1>
                        <a href="#" class="btn btn-lg btn-toolbar" title="Edit Profile"><i class="bi bi-pencil"></i></a>
                    </div>

                    <div class="profile-section">
                        <span class="profile-label">Full Name:</span><br />
                        <span class="profile-value">
                            @Model.FirstName.ToTitleCase()
                            @if (!string.IsNullOrWhiteSpace(Model.MiddleName))
                            {
                                @Model.MiddleName.ToTitleCase()
                            }
                            @Model.LastName.ToTitleCase()
                        </span>
                    </div>

                    <div class="profile-section">
                        <span class="profile-label">Phone:</span><br />
                        <span class="profile-value">@Model.Phone</span>
                    </div>

                    <div class="profile-section">
                        <span class="profile-label">Email:</span><br />
                        <span class="profile-value">@Model.Email</span>
                    </div>

                    <div class="profile-section">
                        <span class="profile-label">Owned Properties:</span><br />
                        <span class="profile-value">@Model.TotalOwnedProperties</span>
                    </div>

                    <div class="profile-section">
                        <span class="profile-label">Owned Units:</span><br />
                        <span class="profile-value">@Model.TotalOwnedUnits</span>
                    </div>

                    <div class="profile-section">
                        <span class="profile-label">Rented Properties:</span><br />
                        <span class="profile-value">@Model.TotalRentedProperties</span>
                    </div>

                    <div class="profile-section">
                        <span class="profile-label">Rented Units:</span><br />
                        <span class="profile-value">@Model.TotalRentedUnits</span>
                    </div>

                    <div class="profile-section">
                        <span class="profile-label">Joined:</span><br />
                        <span class="profile-value">@Model.CreatedAt.ToString("yyyy-MM-dd hh:mm tt")</span>
                    </div>

                    <!-- Payment Info Buttons -->
                    <div class="payment-actions">
                        <div class="section-title">Payment Information</div>
                        <div class="row g-2">
                            <div class="col-md-6">
                                <a asp-action="ManageQRImage" asp-controller="PaymentQRImage" asp-route-ownerId="@Model.Id" class="btn btn-primary w-100">Manage Payment QR</a>
                            </div>
                        </div>
                    </div>

                </div> <!-- End right column -->
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const imgUpload = document.getElementById('imgUpload');
        const profileImage = document.getElementById('profileImage');

        imgUpload.addEventListener('change', function () {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    profileImage.src = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        });
    </script>
}
